DROP TABLE IF EXISTS STUDY_RELATIONSHIP;

CREATE TABLE STUDY_RELATIONSHIP (
    IDENTIFIER SERIAL NOT NULL,
    TYPE_CODE VARCHAR(200) NOT NULL,
    DESCRIPTION_TEXT VARCHAR(1000), 
    COMMENT_TEXT VARCHAR(200),
    SEQUENCE_NUMBER INTEGER , 
    SOURCE_STUDY_PROTOCOL_IDENTIFIER BIGINT NOT NULL,   -- toStudyProtocolIdentifier -- study_protocol_identifier
    TARGET_STUDY_PROTOCOL_IDENTIFIER BIGINT NOT NULL,  -- fromStudyProtocolIdentifier  -- parent identifier
    DATE_LAST_CREATED TIMESTAMP,
    USER_LAST_CREATED VARCHAR(200) ,
    DATE_LAST_UPDATED TIMESTAMP,
    USER_LAST_UPDATED VARCHAR(200) ,
    PRIMARY KEY (IDENTIFIER)
) ;

ALTER TABLE STUDY_RELATIONSHIP ADD CONSTRAINT FK_STUDY_RELATIONSHIP_STUDY_PROTOCOL1
FOREIGN KEY (SOURCE_STUDY_PROTOCOL_IDENTIFIER) REFERENCES STUDY_PROTOCOL (IDENTIFIER)
ON DELETE CASCADE;

ALTER TABLE STUDY_RELATIONSHIP ADD CONSTRAINT FK_STUDY_RELATIONSHIP_STUDY_PROTOCOL2
FOREIGN KEY (TARGET_STUDY_PROTOCOL_IDENTIFIER) REFERENCES STUDY_PROTOCOL (IDENTIFIER)
ON DELETE SET NULL;
