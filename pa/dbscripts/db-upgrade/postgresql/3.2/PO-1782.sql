-- Purpose: To modify the registry data model for enabling organizational access.

-- create a table to map users to studies, and vice versa.
CREATE TABLE STUDY_OWNER
(
    STUDY_ID BIGINT NOT NULL ,
    USER_ID BIGINT NOT NULL,
    PRIMARY KEY (STUDY_ID, USER_ID)
) ;

ALTER TABLE STUDY_OWNER ADD CONSTRAINT FK_STUDY_OWNER_STUDY
FOREIGN KEY (STUDY_ID) REFERENCES STUDY_PROTOCOL (IDENTIFIER)
ON DELETE CASCADE;

ALTER TABLE STUDY_OWNER ADD CONSTRAINT FK_STUDY_OWNER_USER
FOREIGN KEY (USER_ID) REFERENCES REGISTRY_USER (IDENTIFIER)
ON DELETE CASCADE;

-- Add new columns to Registry_User Table - affiliated_org_id, and affiliated_org_user_type
ALTER TABLE REGISTRY_USER ADD COLUMN AFFILIATED_ORG_ID BIGINT;
ALTER TABLE REGISTRY_USER ADD COLUMN AFFILIATED_ORG_USER_TYPE VARCHAR(255);

