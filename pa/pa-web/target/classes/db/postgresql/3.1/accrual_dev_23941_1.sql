DROP TABLE IF EXISTS ACTIVITY_RELATIONSHIP;

-- Table:  ACTIVITY_RELATIONSHIP
CREATE TABLE ACTIVITY_RELATIONSHIP ( 
    IDENTIFIER SERIAL NOT NULL, 
    TYPE_CODE VARCHAR(200),
    PLANNED_ACTIVITY_IDENTIFIER BIGINT NOT NULL,
    PERFORMED_ACTIVITY_IDENTIFIER BIGINT NOT NULL, 
    DATE_LAST_CREATED TIMESTAMP,  
    USER_LAST_CREATED VARCHAR(200),  
    DATE_LAST_UPDATED TIMESTAMP,  
    USER_LAST_UPDATED VARCHAR(200), 
    PRIMARY KEY (IDENTIFIER)  
)WITH (OIDS=FALSE);  

ALTER TABLE ACTIVITY_RELATIONSHIP ADD CONSTRAINT FK_ACTIVITY_RELATIONSHIP_PLANNED_ACTIVITY
FOREIGN KEY (PLANNED_ACTIVITY_IDENTIFIER) REFERENCES PLANNED_ACTIVITY (IDENTIFIER)
ON DELETE CASCADE; 

ALTER TABLE ACTIVITY_RELATIONSHIP ADD CONSTRAINT FK_ACTIVITY_RELATIONSHIP_PERFORMED_ACTIVITY
FOREIGN KEY (PERFORMED_ACTIVITY_IDENTIFIER) REFERENCES PERFORMED_ACTIVITY (IDENTIFIER)
ON DELETE CASCADE; 

DROP TABLE IF EXISTS PERFORMED_OBSERVATION_RESULT;

-- Table:  PERFORMED_OBSERVATION_RESULT
CREATE TABLE PERFORMED_OBSERVATION_RESULT ( 
    IDENTIFIER SERIAL NOT NULL,  
    RESULT_CODE VARCHAR(200),  
    RESULT_CODE_MODIFIED_TEXT VARCHAR(200),  
    RESULT_DATE_RANGE_LOW TIMESTAMP, 
    RESULT_DATE_RANGE_HIGH TIMESTAMP, 
    RESULT_INDICATOR BOOLEAN , 
    RESULT_QUANTITY_VALUE NUMERIC,
    RESULT_QUANTITY_UNIT VARCHAR(200), 
    RESULT_TEXT VARCHAR(2000), 
    TYPE_CODE VARCHAR(200), 
    UNIT_OF_MEASURE_CODE VARCHAR(200), 
    DESCRIPTION VARCHAR(200), 
    GRADE_CODE VARCHAR(200), 
    STAGE_CODING_SYSTEM VARCHAR(200), 
    IMAGE_IDENTIFIER BIGINT,
    SERIES_IDENTIFIER BIGINT,
    LESION_NUMBER BIGINT,
    LONGEST_DIAMETER_VALUE NUMERIC,
    LONGEST_DIAMETER_UNIT VARCHAR(200), 
    MEASURABLE_INDICATOR BOOLEAN ,  
    STUDY_PROTOCOL_IDENTIFIER BIGINT NOT NULL, 
    PERFORMED_ACTIVITY_IDENTIFIER BIGINT,
    PERFORMED_OBSERVATION_RESULT_TYPE VARCHAR(100), 
    DATE_LAST_CREATED TIMESTAMP, 
    USER_LAST_CREATED VARCHAR(200), 
    DATE_LAST_UPDATED TIMESTAMP, 
    USER_LAST_UPDATED VARCHAR(200), 
    PRIMARY KEY (IDENTIFIER) 
)WITH (OIDS=FALSE); 

ALTER TABLE PERFORMED_OBSERVATION_RESULT ADD CONSTRAINT FK_PERFORMED_OBSERVATION_RESULT_STUDY_PROTOCOL
FOREIGN KEY (STUDY_PROTOCOL_IDENTIFIER) REFERENCES STUDY_PROTOCOL (IDENTIFIER)
ON DELETE CASCADE; 
